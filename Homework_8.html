<!DOCTYPE html>
<html lang="en">

<head>
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta charset="UTF-8">
  <title>Trains</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Bootstrap File -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>
     
  <style>
  .ground {
      background: white ;
  }

  .jumbotron {
      background: black;
      color: whitesmoke;
      font-family: Georgia, 'Times New Roman', Times, serif;
      font-size: 300%;
      
      }

  .question {
    color: whitesmoke;

  }

  .timer {
    color: whitesmoke
  }
  
  </style>
   
</head>
   
<body class="ground">
  
  <div class="container">
    
    <div class="rounded">
    <div class="jumbotron">
      <h1 class="text-center">
        <strong class="text-lg-center"><p>Dude, Where's My Train?</p></strong>
        <p>A State of the Art Train Logistics System Complete With the Ability For You To Choose When Your Train Leaves And What Frequency It Visits Your Station!</p>
      </h1>
    </div>
    </div>
  
    <hr>
    
    <h1 class="text-center">
        <table class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Current Time</th>
                <th scope="col">Time Until Next Train</th>
                <th scope="col">Train Name</th>
                <th scope="col">Destination</th>
                <th scope="col">First Train Departure</th>
                <th scope="col">Frequency of Trains</th>

              </tr>
            </thead>
            <tbody class = appendData>
            </tbody>
          </table>
    </h1>

    <h1 class="text-center"></h1>
    <form id = "data form">
        <div class="form-group">
          <label for="EmployeeName">Train Name</label>
          <input type="name" class="form-control" id="EmployeeName" aria-describedby="EmployeeName" placeholder="Enter Train Name">
        </div>
        <div class="form-group">
          <label for="employeeRole">Destination</label>
          <input type="destination" class="form-control" id="employeeRole" placeholder="Input Destination Here">
        </div>
        <div class="employeeStart">
            <label for="firstTime">First Train Time</label>
            <input type="time" class="form-control" id="employeeStart" placeholder="Input The first Train Departure Time Here">
          </div>
        <div class="form-group">
            <label for="monthlyRate">Train Frequency (minutes)</label>
            <input type="number" class="form-control" id="employeeRate" placeholder="Input The Frequency That The Train Stops At Your Station Here">
         </div>
         <input id="add-data" type="submit" value="Submit">
      </form>
    </h1>
  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
    
 var config = {
    apiKey: "AIzaSyBTN4ZrT9VjsCrMfC4-gCNfZwnxqpFrqzY",
    authDomain: "kelsey-s-first-project.firebaseapp.com",
    databaseURL: "https://kelsey-s-first-project.firebaseio.com",
    projectId: "kelsey-s-first-project",
    storageBucket: "kelsey-s-first-project.appspot.com",
    messagingSenderId: "847945600370"
  };

firebase.initializeApp(config);

var database = firebase.database();
var name = "";
var role = "";
var start = 0;
var rate = 0;

$("#add-data").on("click", function(event) {

  event.preventDefault();

    name = $("#EmployeeName").val().trim();
    role = $("#employeeRole").val().trim();
    start = $("#employeeStart").val().trim();
    console.log(start)
    rate = $("#employeeRate").val().trim();
    database.ref().push({
    name: name,
    role: role,
    start: start,
    rate: rate,
    dateAdded: firebase.database.ServerValue.TIMESTAMP
    });
});

var today = new Date();
var todayString = today.toString()
var dd = today.getDate();
var mm = today.getMonth()+1; 
var yyyy = today.getFullYear();

if(dd<10) {
    dd = '0'+dd
} 

if(mm<10) {
    mm = '0'+mm
} 

console.log(today)

currentTime = todayString.substring(15,21)
currentMilitary = parseInt(todayString.substring(15,21).replace(":",""))

console.log( "this is today "+currentMilitary)

database.ref().on("child_added", function(snapshot) {
          
  var sv = snapshot.val();
  console.log(sv)

  var trainName = sv.name;
  var destination = sv.role;
  var firstTrain = sv.start;
  var trainFrequency = sv.rate;
  var firstTrainClean = firstTrain.replace(":", "")
  var firstTrainMilitary = parseInt(firstTrainClean)
  var timeDif = Math.abs(firstTrainMilitary-currentMilitary)
  var difHours = parseInt(timeDif.toString().slice(0,2))
  var difMinutes = parseInt(timeDif.toString().slice(2,4))
  var minutesSince = (difHours*12)+difMinutes
  var timeUntil = minutesSince%trainFrequency          
  var dataArray = [ sv.rate, sv.start, sv.role, sv.name, timeUntil, currentTime ]
  
  console.log(dataArray)

  var dataTR = $("<tr> </tr>");
  for (i=0; i<dataArray.length; i++) {
    var instaData = $("<td> </td>")
    
    instaData.text(dataArray[i])

    dataTR.prepend(instaData)

  }

  $(".appendData").append(dataTR)
       
}, function(errorObject) {
  console.log("Errors handled: " + errorObject.code);
  });

  </script>
</body>
</html>

